# Exercise ID System and Structure

This document outlines the ID system for exercises within the Matechicos application and provides guidance for adding new exercises.

## Exercise ID Format

Each exercise in the application has a unique ID following a structured format:

`g<GradeNumber>-s<SubjectIndex>-e<ExerciseIndex>`

Where:
*   `g<GradeNumber>`: Indicates the grade level (e.g., `g1` for 1st Grade, `g3` for 3rd Grade).
*   `s<SubjectIndex>`: Indicates the subject within that grade. This is a **1-based index** corresponding to the order of subjects defined in `SUBJECTS_TEMPLATES` in `src/constants.ts` (e.g., `s1` for the first subject like Numeros, `s2` for the second subject like Operaciones).
*   `e<ExerciseIndex>`: Indicates the specific exercise within that subject. This is a **1-based index** relative to its position in the subject's exercise list.

**Example:**
The exercise "Escribir hasta 10.000." is:
*   For 3rd Grade (`g3`)
*   The first subject (Numeros, which is at index 0 in `SUBJECTS_TEMPLATES`, so its 1-based subject index is `1`, hence `s1`)
*   The first exercise in that subject's list (1-based index `1`, hence `e1`)
Its ID is: `g3-s1-e1`

Another example for a templated exercise:
The second exercise in the "Operaciones" subject for 2nd Grade:
*   Grade: `g2`
*   Subject "Operaciones": If "Operaciones" is the second entry in `SUBJECTS_TEMPLATES` (index 1), then `s2`.
*   Exercise: Second exercise in that subject's template, `e2`.
ID: `g2-s2-e2`

## Adding New Exercises

### 1. Generic Exercises (via `SUBJECTS_TEMPLATES`)

These exercises use the generic display format and their content is usually a simple text description.

1.  **Locate `SUBJECTS_TEMPLATES`**: Open `src/constants.ts`.
2.  **Find or Add Subject**:
    *   If adding to an existing subject, find its entry in `SUBJECTS_TEMPLATES`.
    *   If it's a new subject, add a new object to the `SUBJECTS_TEMPLATES` array, defining its `id` (from `SubjectId` enum), `name`, `iconName`, and an empty `exerciseTemplates` array.
3.  **Add Exercise Template**:
    *   In the `exerciseTemplates` array of the chosen subject, add a new object with:
        *   `title: string`: The title of the exercise.
        *   `description: string`: A short description.
        *   `iconName?: OriginalIconName`: (Optional) Specify an icon from `OriginalIconName` in `src/components/icons.tsx`. If omitted, it defaults to `BookOpenIcon`.
4.  **ID Generation**: The ID will be automatically generated by the `createExercise` function based on the grade, the subject's 0-based index in `SUBJECTS_TEMPLATES`, and the exercise's 0-based index within its `exerciseTemplates` array. The function converts these to 1-based for the ID string.
5.  **Locking**: Default locking logic is in `_generateSubjectsForGrade`. You might need to adjust this if specific rules apply.

**Example (adding to existing subject):**
In `src/constants.ts`, under `SubjectId.NUMEROS`:
```typescript
// ...
{
  id: SubjectId.NUMEROS, name: 'Números', iconName: 'NumbersIcon', exerciseTemplates: [
    { title: 'Contar hasta 100', description: 'Aprende los números y a contar.' },
    { title: 'Valor Posicional', description: 'Unidades, decenas y centenas.' },
    // New exercise added here
    { title: 'Secuencias Numéricas', description: 'Completa secuencias de números.' },
  ]
},
// ...
```

### 2. Specific Interactive Exercise Components

These exercises have custom UI and logic (e.g., `EscribirHasta10000Exercise.tsx`).

1.  **Create the Exercise Component File**:
    *   Create a new `.tsx` file in the `src/exercises/` directory (e.g., `MyNewInteractiveExercise.tsx`).
    *   This component typically receives props: `exercise: ExerciseType`, `currentAvatar: AvatarData`, navigation callbacks (`onNavigateBack`, `onGoHome`, `onAvatarClick`), and an `onComplete` callback.
    *   Implement the unique UI and logic. `ExerciseScaffold.tsx` can be used for a consistent layout.

2.  **Define `ExerciseComponentType` (if new type)**:
    *   In `src/types.ts`, if this exercise represents a new category of interaction, add a new value to the `ExerciseComponentType` enum (e.g., `MY_NEW_INTERACTIVE = 'my_new_interactive'`). Often, you might reuse `ExerciseComponentType.GENERIC` if it's a one-off custom display not warranting a new type, or a more specific type if it's a reusable pattern.

3.  **Register in `constants.ts`**:
    *   **Option A (Part of a specific list, e.g., `thirdGradeNumerosExercises`):**
        *   If the exercise is unique to a grade/subject and not from a template, add it directly to a pre-defined list like `thirdGradeNumerosExercises`.
        *   Manually define the full `Exercise` object:
            *   `id`: Set manually according to the `g<G>-s<S>-e<E>` format. Ensure it's unique and correctly reflects its intended grade, subject-order, and exercise-order.
            *   `title`, `description`, `iconName`.
            *   `isLocked`: Boolean.
            *   `componentType`: Set to the specific type (e.g., `ExerciseComponentType.ESCRIBIR_HASTA_10000` or your new type).
            *   `data`: Any specific data the component needs (e.g., `{ correctAnswer: "42", options: [...] }`).
            *   `question`: The question prompt for the exercise.
            *   `content`: Fallback content if needed, often similar to description.
    *   **Option B (Overriding a templated exercise):**
        *   This is more complex. You would need to modify `_generateSubjectsForGrade` or the merging logic in `getGradeData` to intercept the creation of a templated exercise (based on its generated ID or original title) and replace/update its `componentType`, `data`, `question`, etc. This is generally done when a standard exercise slot needs custom behavior for a specific grade.

4.  **Update `ExercisePage.tsx`**:
    *   In `src/pages/ExercisePage.tsx`, import your new specific exercise component.
    *   Add a new `case` to the `switch (exerciseData.componentType)` statement to render your component when its `componentType` is matched.

**Example (adding to `thirdGradeNumerosExercises`):**
Assuming "Numeros" is the 1st subject (index 0) for 3rd grade, and this is the 13th exercise:
```typescript
// In src/constants.ts, within thirdGradeNumerosExercises array:
{
  id: 'g3-s1-e13', // Manually assigned ID
  title: 'Nuevo Ejercicio Interactivo',
  description: 'Un desafío completamente nuevo.',
  iconName: 'ProblemsIcon', // Or other appropriate icon
  isLocked: false,
  componentType: ExerciseComponentType.MY_NEW_INTERACTIVE, // Assuming you added this type
  data: { /* some specific data */ initialValue: 10, targetValue: 50 },
  question: '¿Puedes resolver este nuevo desafío?',
  content: 'Descripción del nuevo ejercicio interactivo.'
}
```
Then, in `src/pages/ExercisePage.tsx`:
```typescript
// ... imports ...
import { MyNewInteractiveExercise } from '../exercises/MyNewInteractiveExercise'; // Your new component

// ... inside ExercisePage component ...
switch (exerciseData.componentType) {
  // ... other cases ...
  case ExerciseComponentType.MY_NEW_INTERACTIVE:
    return <MyNewInteractiveExercise exercise={exerciseData} {...commonProps} />;
  default:
    // ...
}
```

### Important Considerations:

*   **ID Uniqueness & Correctness**: Double-check that all manually assigned or generated IDs are unique and correctly reflect the grade, subject order (1-based), and exercise order (1-based).
*   **Indices**: When working with array indices (0-based) in code (like `subjectIndex`, `exIndex` in `_generateSubjectsForGrade`), remember these are converted to 1-based for the ID string.
*   **Data Completeness**: For specific components, ensure all necessary fields (`componentType`, `data`, `question`) are correctly provided in `constants.ts`.
*   **Subject Order**: The `s<SubjectIndex>` part of the ID depends on the order of subjects in the `SUBJECTS_TEMPLATES` array. If this order changes, IDs might need to be updated if they were hardcoded based on a previous order.
```
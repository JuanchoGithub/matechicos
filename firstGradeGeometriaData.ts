
import { Exercise, ExerciseComponentType, OriginalIconName, GenericVisualChallenge, BasicShapeTypeId, BasicShapeDefinition, BASIC_SHAPE_LABELS, LineType, LINE_TYPE_LABELS, SpatialChallenge, SpatialConcept } from './types';
import { RectaHorizontalSVG, CurvaSimpleSVG, PoligonalAbiertaSVG1, PoligonalCerradaSVG1, Circulo2DSVG, CuadradoSVG, TrianguloEquilateroSVG, RectanguloSVG, CurvaCerradaSVG } from './geometryDefinitions';

// Helper function to shuffle an array (if not already available globally)
const shuffleArray = <T,>(array: T[]): T[] => {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
};

// --- Data for spatial relationships ---
const spatialChallengesRawData: {concept: SpatialConcept, data: Omit<SpatialChallenge, 'options' | 'emoji'>[], options: {id:string, label:string}[] }[] = [
  {
    concept: 'dentro_fuera',
    options: [{ id: 'dentro', label: 'Dentro' }, { id: 'fuera', label: 'Fuera' }],
    data: [
      { id: 'apple_box_in', visuals: { item: 'üçé', reference: 'üì¶', position: 'inside' }, itemLabel: 'la manzana', referenceLabel: 'la caja', correctAnswerId: 'dentro' },
      { id: 'ball_basket_out', visuals: { item: '‚öΩ', reference: 'üß∫', position: 'outside' }, itemLabel: 'la pelota', referenceLabel: 'la canasta', correctAnswerId: 'fuera' },
      { id: 'bird_cage_in', visuals: { item: 'üê¶', reference: 'ü•Ö', position: 'inside' }, itemLabel: 'el p√°jaro', referenceLabel: 'la jaula', correctAnswerId: 'dentro' },
      { id: 'fish_bowl_out', visuals: { item: 'üê†', reference: 'ü•£', position: 'outside' }, itemLabel: 'el pez', referenceLabel: 'la pecera', correctAnswerId: 'fuera' },
      { id: 'dog_house_in', visuals: { item: 'üê∂', reference: 'üè†', position: 'inside' }, itemLabel: 'el perro', referenceLabel: 'la casa', correctAnswerId: 'dentro'},
      { id: 'cat_box_out', visuals: { item: 'üêà', reference: 'üéÅ', position: 'outside' }, itemLabel: 'el gato', referenceLabel: 'la caja de regalo', correctAnswerId: 'fuera'},
    ]
  },
  {
    concept: 'arriba_abajo',
    options: [{ id: 'arriba', label: 'Arriba' }, { id: 'abajo', label: 'Abajo' }],
    data: [
      { id: 'cloud_tree_up', visuals: { item: '‚òÅÔ∏è', reference: 'üå≥', position: 'above' }, itemLabel: 'la nube', referenceLabel: 'el √°rbol', correctAnswerId: 'arriba' },
      { id: 'book_table_down', visuals: { item: 'üìö', reference: 'ü™ë', position: 'below' }, itemLabel: 'el libro', referenceLabel: 'la silla', correctAnswerId: 'abajo' },
      { id: 'sun_house_up', visuals: { item: '‚òÄÔ∏è', reference: 'üè†', position: 'above' }, itemLabel: 'el sol', referenceLabel: 'la casa', correctAnswerId: 'arriba' },
      { id: 'worm_ground_down', visuals: { item: 'üêõ', reference: 'üå±', position: 'below' }, itemLabel: 'el gusano', referenceLabel: 'la planta', correctAnswerId: 'abajo' },
      { id: 'star_moon_up', visuals: { item: '‚≠ê', reference: 'üåô', position: 'above'}, itemLabel: 'la estrella', referenceLabel: 'la luna', correctAnswerId: 'arriba'},
      { id: 'ball_floor_down', visuals: { item: 'üéà', reference: 'üëü', position: 'below'}, itemLabel: 'el globo', referenceLabel: 'el zapato', correctAnswerId: 'abajo'},
    ]
  },
  {
    concept: 'encima_debajo',
    options: [{ id: 'encima', label: 'Encima' }, { id: 'debajo', label: 'Debajo' }],
    data: [
      { id: 'cat_mat_on', visuals: { item: 'üêà', reference: 'üü©', position: 'on_top' }, itemLabel: 'el gato', referenceLabel: 'la alfombra', correctAnswerId: 'encima' },
      { id: 'shoes_bed_under', visuals: { item: 'üëü', reference: 'üõèÔ∏è', position: 'under' }, itemLabel: 'los zapatos', referenceLabel: 'la cama', correctAnswerId: 'debajo' },
      { id: 'hat_head_on', visuals: { item: 'üëí', reference: 'üòÄ', position: 'on_top' }, itemLabel: 'el sombrero', referenceLabel: 'la cabeza', correctAnswerId: 'encima' },
      { id: 'toy_chair_under', visuals: { item: 'üß∏', reference: 'ü™ë', position: 'under' }, itemLabel: 'el juguete', referenceLabel: 'la silla', correctAnswerId: 'debajo' },
      { id: 'plate_table_on', visuals: { item: 'üçΩÔ∏è', reference: 'üüß', position: 'on_top' }, itemLabel: 'el plato', referenceLabel: 'la mesa', correctAnswerId: 'encima'},
      { id: 'mouse_table_under', visuals: { item: 'üêÅ', reference: 'üüß', position: 'under' }, itemLabel: 'el rat√≥n', referenceLabel: 'la mesa', correctAnswerId: 'debajo'},
    ]
  },
   {
    concept: 'adelante_atras',
    options: [{ id: 'adelante', label: 'Adelante' }, { id: 'atras', label: 'Atr√°s' }],
    data: [
      { id: 'car_house_front', visuals: { item: 'üöó', reference: 'üè†', position: 'in_front' }, itemLabel: 'el auto', referenceLabel: 'la casa', correctAnswerId: 'adelante' },
      { id: 'child_tree_behind', visuals: { item: 'üßç', reference: 'üå≥', position: 'behind' }, itemLabel: 'el ni√±o', referenceLabel: 'el √°rbol', correctAnswerId: 'atras' },
      { id: 'bus_stop_front', visuals: { item: 'üöå', reference: 'üöè', position: 'in_front'}, itemLabel: 'el autob√∫s', referenceLabel: 'la parada', correctAnswerId: 'adelante'},
      { id: 'backpack_person_behind', visuals: { item: 'üéí', reference: 'üö∂', position: 'behind'}, itemLabel: 'la mochila', referenceLabel: 'la persona', correctAnswerId: 'atras'},
    ]
  },
  {
    concept: 'derecha_izquierda',
    options: [{ id: 'derecha', label: 'A la Derecha' }, { id: 'izquierda', label: 'A la Izquierda' }],
    data: [
      { id: 'apple_pear_right', visuals: { item: 'üçé', reference: 'üçê', position: 'right_of_pear' }, itemLabel: 'la manzana', referenceLabel: 'la pera', correctAnswerId: 'derecha' },
      { id: 'ball_box_left', visuals: { item: '‚öΩ', reference: 'üì¶', position: 'left_of_box' }, itemLabel: 'la pelota', referenceLabel: 'la caja', correctAnswerId: 'izquierda' },
      { id: 'sun_cloud_right', visuals: { item: '‚òÄÔ∏è', reference: '‚òÅÔ∏è', position: 'right_of_cloud'}, itemLabel: 'el sol', referenceLabel: 'la nube', correctAnswerId: 'derecha'},
      { id: 'moon_star_left', visuals: { item: 'üåô', reference: '‚≠ê', position: 'left_of_star'}, itemLabel: 'la luna', referenceLabel: 'la estrella', correctAnswerId: 'izquierda'},
    ]
  },
];

const spatialExercises: Exercise[] = spatialChallengesRawData.map((conceptData, index) => {
    const { concept, data: challengesData, options } = conceptData;
    const title = concept.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' o ');
    return {
        id: `g1-s5-e${index + 1}`, // Subject 5 (Geometr√≠a)
        title: title,
        description: `Identifica si un objeto est√° ${options[0].label.toLowerCase()} o ${options[1].label.toLowerCase()} de otro.`,
        iconName: 'GeometryIcon' as OriginalIconName,
        isLocked: false,
        componentType: ExerciseComponentType.POSICION_RELATIVA_OBJETOS,
        data: {
            totalStars: challengesData.length > 0 ? challengesData.length : 4,
            concept: concept,
            questionTemplateString: `¬ø{itemLabel} est√° {optionPlaceholder} de {referenceLabel}?`, // Corrected template
            challenges: shuffleArray(challengesData.map(cd => ({...cd, emoji: cd.visuals.item }))),
            options: options
        },
        question: `¬ø${title}?`,
    };
});


// --- Challenges for Line Types (Recta, Curva, Quebrada) ---
const lineTypeChallengesG1: GenericVisualChallenge[] = [
  { id: 'g1_linea_recta', VisualComponent: RectaHorizontalSVG, visualProps: {className: "w-32 h-16"}, correctAnswerId: 'recta', options: [{id:'recta', label:LINE_TYPE_LABELS.recta}, {id:'curva', label:LINE_TYPE_LABELS.curva}, {id:'poligonal', label:LINE_TYPE_LABELS.poligonal}], emoji: 'üìè'},
  { id: 'g1_linea_curva', VisualComponent: CurvaSimpleSVG, visualProps: {className: "w-32 h-16"}, correctAnswerId: 'curva', options: [{id:'recta', label:LINE_TYPE_LABELS.recta}, {id:'curva', label:LINE_TYPE_LABELS.curva}, {id:'poligonal', label:LINE_TYPE_LABELS.poligonal}], emoji: 'üåä'},
  { id: 'g1_linea_poligonal', VisualComponent: PoligonalAbiertaSVG1, visualProps: {className: "w-32 h-20"}, correctAnswerId: 'poligonal', options: [{id:'recta', label:LINE_TYPE_LABELS.recta}, {id:'curva', label:LINE_TYPE_LABELS.curva}, {id:'poligonal', label:LINE_TYPE_LABELS.poligonal}], emoji: 'üìà'},
  // Add more simple examples for each type if needed
  { id: 'g1_linea_recta_2', VisualComponent: RectaHorizontalSVG, visualProps: {className: "w-28 h-12", strokeColor:"blue"}, correctAnswerId: 'recta', options: [{id:'recta', label:LINE_TYPE_LABELS.recta}, {id:'curva', label:LINE_TYPE_LABELS.curva}, {id:'poligonal', label:LINE_TYPE_LABELS.poligonal}], emoji: 'üìè'},
  { id: 'g1_linea_curva_2', VisualComponent: CurvaSimpleSVG, visualProps: {className: "w-28 h-12", strokeColor:"green"}, correctAnswerId: 'curva', options: [{id:'recta', label:LINE_TYPE_LABELS.recta}, {id:'curva', label:LINE_TYPE_LABELS.curva}, {id:'poligonal', label:LINE_TYPE_LABELS.poligonal}], emoji: 'üåä'},
  { id: 'g1_linea_poligonal_2', VisualComponent: PoligonalAbiertaSVG1, visualProps: {className: "w-28 h-18", strokeColor:"red"}, correctAnswerId: 'poligonal', options: [{id:'recta', label:LINE_TYPE_LABELS.recta}, {id:'curva', label:LINE_TYPE_LABELS.curva}, {id:'poligonal', label:LINE_TYPE_LABELS.poligonal}], emoji: 'üìà'},
];

// --- Challenges for Line Open/Closed ---
const lineOpenClosedChallengesG1: GenericVisualChallenge[] = [
  { id: 'g1_linea_abierta_curva', VisualComponent: CurvaSimpleSVG, visualProps: {className: "w-32 h-16"}, correctAnswerId: 'abierta', options: [{id:'abierta', label:'Abierta'}, {id:'cerrada', label:'Cerrada'}], emoji: 'üåä'},
  { id: 'g1_linea_abierta_poligonal', VisualComponent: PoligonalAbiertaSVG1, visualProps: {className: "w-32 h-20"}, correctAnswerId: 'abierta', options: [{id:'abierta', label:'Abierta'}, {id:'cerrada', label:'Cerrada'}], emoji: 'üìà'},
  { id: 'g1_linea_cerrada_poligonal', VisualComponent: PoligonalCerradaSVG1, visualProps: {className: "w-28 h-28"}, correctAnswerId: 'cerrada', options: [{id:'abierta', label:'Abierta'}, {id:'cerrada', label:'Cerrada'}], emoji: 'üñºÔ∏è'},
  { id: 'g1_linea_cerrada_curva', VisualComponent: CurvaCerradaSVG, visualProps: {className: "w-28 h-28", fillColor:"rgba(173,216,230,0.3)"}, correctAnswerId: 'cerrada', options: [{id:'abierta', label:'Abierta'}, {id:'cerrada', label:'Cerrada'}], emoji: 'ü•ö'},
  // Add more simple examples
  { id: 'g1_linea_abierta_recta', VisualComponent: RectaHorizontalSVG, visualProps: {className: "w-32 h-16"}, correctAnswerId: 'abierta', options: [{id:'abierta', label:'Abierta'}, {id:'cerrada', label:'Cerrada'}], emoji: 'üìè'},
  { id: 'g1_linea_cerrada_cuadrado', VisualComponent: CuadradoSVG, visualProps: {className: "w-28 h-28", fillColor: "rgba(255, 215, 0, 0.2)"}, correctAnswerId: 'cerrada', options: [{id:'abierta', label:'Abierta'}, {id:'cerrada', label:'Cerrada'}], emoji: 'üü®'},
];

// --- Challenges for Basic Shapes ---
const basicShapesDefinitionsG1: BasicShapeDefinition[] = [
  { id: 'circulo', name: 'C√≠rculo', description: 'Figura redonda sin lados ni esquinas.', VisualComponent: Circulo2DSVG },
  { id: 'cuadrado', name: 'Cuadrado', description: 'Tiene 4 lados iguales y 4 esquinas rectas.', VisualComponent: CuadradoSVG },
  { id: 'triangulo', name: 'Tri√°ngulo', description: 'Tiene 3 lados y 3 esquinas.', VisualComponent: TrianguloEquilateroSVG },
  { id: 'rectangulo', name: 'Rect√°ngulo', description: 'Tiene 4 lados, los opuestos son iguales, y 4 esquinas rectas.', VisualComponent: RectanguloSVG },
];

const transformedBasicShapesChallengesG1: GenericVisualChallenge[] = basicShapesDefinitionsG1.map(def => ({
  id: `g1_shape_${def.id}`,
  VisualComponent: def.VisualComponent,
  visualProps: { className: "w-28 h-28", strokeColor: "rgb(75, 85, 99)", fillColor: def.id === 'circulo' ? 'rgba(250, 204, 21, 0.4)' : def.id === 'cuadrado' ? 'rgba(59, 130, 246, 0.4)' : def.id === 'triangulo' ? 'rgba(34, 197, 94, 0.4)' : 'rgba(239, 68, 68, 0.4)' },
  correctAnswerId: def.id,
  options: (Object.keys(BASIC_SHAPE_LABELS) as BasicShapeTypeId[]).map(typeId => ({ id: typeId, label: BASIC_SHAPE_LABELS[typeId] })),
  description: def.description,
  emoji: def.id === 'circulo' ? 'üü†' : def.id === 'cuadrado' ? 'üü¶' : def.id === 'triangulo' ? 'üî∫' : 'üü•'
}));


export const firstGradeGeometriaExercises: Exercise[] = [
  ...spatialExercises, // Add the 5 spatial exercises first (e1-e5)
  {
    id: 'g1-s5-e6', title: 'L√≠neas: Recta, Curva, Quebrada', description: 'Identifica los tipos b√°sicos de l√≠neas.',
    iconName: 'GeometryIcon' as OriginalIconName, isLocked: false, componentType: ExerciseComponentType.IDENTIFICAR_FORMA_GEOMETRICA_GENERICO,
    data: { totalStars: Math.min(6, lineTypeChallengesG1.length), questionPrompt: "¬øQu√© tipo de l√≠nea es?", challenges: shuffleArray(lineTypeChallengesG1) },
    question: '¬øQu√© tipo de l√≠nea es?',
  },
  {
    id: 'g1-s5-e7', title: 'L√≠neas: Abierta o Cerrada', description: 'Distingue entre l√≠neas abiertas y cerradas.',
    iconName: 'GeometryIcon' as OriginalIconName, isLocked: false, componentType: ExerciseComponentType.IDENTIFICAR_FORMA_GEOMETRICA_GENERICO,
    data: { totalStars: Math.min(6, lineOpenClosedChallengesG1.length), questionPrompt: "¬øLa l√≠nea es abierta o cerrada?", challenges: shuffleArray(lineOpenClosedChallengesG1) },
    question: '¬øLa l√≠nea es abierta o cerrada?',
  },
  {
    id: 'g1-s5-e8', title: 'Figuras: C√≠rculo, Cuadrado, Tri√°ngulo, Rect√°ngulo', description: 'Reconoce las formas geom√©tricas b√°sicas.',
    iconName: 'GeometryIcon' as OriginalIconName, isLocked: false, componentType: ExerciseComponentType.IDENTIFICAR_FORMA_GEOMETRICA_GENERICO,
    data: { totalStars: Math.min(8, transformedBasicShapesChallengesG1.length * 2), questionPrompt: "¬øQu√© figura es?", challenges: shuffleArray([...transformedBasicShapesChallengesG1, ...transformedBasicShapesChallengesG1]) }, // Duplicate for more practice
    question: '¬øQu√© figura es?',
  },
  {
    id: 'g1-s5-e9', title: 'Identificar Figuras B√°sicas (M√°s Pr√°ctica)', description: 'M√°s pr√°ctica reconociendo c√≠rculo, cuadrado, tri√°ngulo y rect√°ngulo.',
    iconName: 'GeometryIcon' as OriginalIconName, isLocked: false, componentType: ExerciseComponentType.IDENTIFICAR_FORMA_GEOMETRICA_GENERICO,
    data: { totalStars: Math.min(8, transformedBasicShapesChallengesG1.length * 2), questionPrompt: "¬øQu√© figura geom√©trica es?", challenges: shuffleArray([...transformedBasicShapesChallengesG1, ...transformedBasicShapesChallengesG1]) }, // Duplicate for more practice
    question: '¬øQu√© figura geom√©trica es?',
  },
];
